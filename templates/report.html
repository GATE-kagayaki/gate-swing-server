<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GATE AIスイングドクター｜SWING ANALYSIS REPORT</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
    font-family: 'Noto Sans JP', sans-serif;
    background: #f3f4f6;
}
.paper {
    background: #ffffff;
    max-width: 900px;
    margin: 20px auto;
    padding: 32px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}
h2 {
    border-left: 4px solid #111827;
    padding-left: 12px;
    margin-top: 40px;
    font-weight: 700;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 12px;
}
th, td {
    border: 1px solid #e5e7eb;
    padding: 10px;
    font-size: 0.95rem;
    vertical-align: top;
}
th {
    background: #f9fafb;
    width: 35%;
}
.loading {
    text-align: center;
    padding: 80px 0;
}
.eval-good {
    color: #065f46;
}
.eval-bad {
    color: #7c2d12;
}
</style>
</head>

<body>
<div class="paper">

<h1 class="text-2xl font-bold text-center mb-2">GATE AIスイングドクター</h1>
<p class="text-center text-sm mb-6 text-gray-600">SWING ANALYSIS REPORT</p>

<div id="loading" class="loading">
    <p class="text-gray-500 text-sm">レポートデータを読み込み中です…</p>
</div>

<div id="content" class="hidden">

<p class="text-xs text-gray-500 mb-6">
REPORT ID：<span id="reportId"></span>
</p>

<!-- ===================== -->
<!-- 01 骨格計測データ -->
<!-- ===================== -->
<h2>01. 骨格計測データ（AIが測定）</h2>

<table>
<tbody id="data-table"></tbody>
</table>

<!-- ===================== -->
<!-- 07 総合評価 -->
<!-- ===================== -->
<h2>07. 総合評価</h2>

<div id="summary" class="mt-4 text-gray-700 leading-relaxed space-y-4"></div>

<!-- ===================== -->
<!-- 有料版誘導（最終確定文） -->
<!-- ===================== -->
<div class="mt-12 p-5 border border-gray-300 bg-gray-50 text-sm text-gray-700">
  <p class="font-bold mb-2">より詳しい分析をご希望の方へ</p>
  <p class="mb-2">
    本レポートでは、スイング全体の傾向を
    骨格データに基づいて評価しています。
  </p>
  <p>
    ご自身のスイングを深く理解したい方は、
    ぜひフルレポートをご活用ください。
  </p>
</div>

</div>
</div>

<script>
const reportId = location.pathname.split("/").pop();
document.getElementById("reportId").innerText = reportId;

const loading = document.getElementById("loading");
const content = document.getElementById("content");
const table = document.getElementById("data-table");
const summary = document.getElementById("summary");

const meta = {
    "解析フレーム数": {
        desc: "動画から解析できたフレーム数です。数が多いほど、動作全体を安定して解析できています。",
        guide: "150～300 フレーム"
    },
    "最大肩回転角": {
        desc: "スイング中に肩がどれだけ回転したかを示す角度です。上半身の回旋量の指標になります。",
        guide: "80～110°"
    },
    "最小腰回転角": {
        desc: "スイング中に腰が最も回転した瞬間の角度です。下半身の回旋量を表します。",
        guide: "35～45°"
    },
    "最大手首コック角": {
        desc: "スイング中に手首が最も折れた角度です。クラブのコック量の指標になります。",
        guide: "120～150°"
    },
    "最大頭部ブレ": {
        desc: "スイング中に頭の位置が左右にどれだけ動いたかを示します。スイング軸の安定性を表します。",
        guide: "0.05～0.15"
    },
    "最大膝ブレ": {
        desc: "スイング中に膝が左右にどれだけ動いたかを示します。下半身の安定性の指標です。",
        guide: "0.05～0.20"
    }
};

fetch(`/api/report_data/${reportId}`)
.then(res => res.json())
.then(data => {
    loading.classList.add("hidden");
    content.classList.remove("hidden");

    const a = data.analysis || {};

    /* -------- 01 表示 -------- */
    Object.keys(meta).forEach(key => {
        if (!(key in a)) return;

        const value = a[key];
        const unit = key.includes("角") ? "°" : "";

        table.innerHTML += `
        <tr>
            <th>${key}</th>
            <td>
                <strong>計測結果：</strong>${value}${unit}<br><br>
                <strong>説明：</strong>${meta[key].desc}<br><br>
                <strong>目安：</strong>${meta[key].guide}
            </td>
        </tr>`;
    });

    /* -------- 07 総合評価 -------- */
    const good = [];
    const bad = [];

    if (a["最大頭部ブレ"] <= 0.15 && a["最大膝ブレ"] <= 0.2) {
        good.push("頭部および下半身のブレが少なく、スイング軸が安定しています。");
    } else {
        bad.push("頭部または下半身にブレが見られ、再現性に影響する可能性があります。");
    }

    if (a["最大肩回転角"] >= 80 && a["最大肩回転角"] <= 110) {
        good.push("上半身の回旋量が適正範囲にあり、効率よくパワーを生み出せています。");
    } else {
        bad.push("肩の回転量が適正範囲から外れており、パワーロスの要因になる可能性があります。");
    }

    if (a["最小腰回転角"] < 35) {
        bad.push("下半身の回旋がやや不足しており、上半身主導になりやすい傾向があります。");
    }

    let html = "";
    if (good.length) {
        html += "<p class='eval-good'><strong>良い点</strong><br>" + good.join("<br>") + "</p>";
    }
    if (bad.length) {
        html += "<p class='eval-bad'><strong>改善点</strong><br>" + bad.join("<br>") + "</p>";
    }

    html += "<p>全体として、安定性を土台にしたスイングができており、適切な調整を行うことでさらなる向上が期待できます。</p>";

    summary.innerHTML = html;
});
</script>

</body>
</html>
