<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>GATE AIスイングドクター</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
<div class="max-w-3xl mx-auto bg-white p-6 mt-6 shadow">

<h1 class="text-2xl font-bold text-center">GATE AIスイングドクター</h1>
<p class="text-center text-sm text-gray-500 mb-4">SWING ANALYSIS REPORT</p>

<div id="loading">解析処理中です...</div>
<div id="content" class="hidden"></div>

</div>

<script>
const reportId = location.pathname.split("/").pop();

fetch(`/api/report_data/${reportId}`)
.then(r => r.json())
.then(d => {
  if (d.status !== "COMPLETED") return;
  document.getElementById("loading").remove();
  const root = document.getElementById("content");
  root.classList.remove("hidden");

  Object.values(d.analysis).forEach(sec => {
    const h = document.createElement("h2");
    h.className = "mt-6 font-bold text-lg";
    h.textContent = sec.title;
    root.appendChild(h);

    if (sec.data) {
      const t = document.createElement("table");
      t.className = "w-full border mt-2";
      Object.entries(sec.data).forEach(([k,v])=>{
        t.innerHTML += `<tr><th class="border p-2">${k}</th><td class="border p-2">${v}</td></tr>`;
      });
      root.appendChild(t);
    }

    if (sec.text) {
      sec.text.forEach(p=>{
        const el = document.createElement("p");
        el.textContent = p;
        root.appendChild(el);
      });
    }

    if (sec.drills) {
      sec.drills.forEach(d=>{
        root.innerHTML += `<p>【${d["ドリル名"]}】${d["やり方"]}</p>`;
      });
    }
  });
});
</script>
</body>
</html>
